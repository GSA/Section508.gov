<div class="grid-row">
  @if (sideMenu.sideNavItems.length > 0) {
    <div
      class="tablet:grid-col-3 margin-bottom-3 tablet:margin-bottom-0 tablet:margin-right-6"
      >
      <art-side-navigation
        (menuItemSelected)="onSideNavItemSelected($event)"
        [sideMenu]="sideMenu"
      ></art-side-navigation>
    </div>
  }
  <!-- Will display all ICT FORM 1..10-->
  <div class="tablet:grid-col-8 tablet:margin-bottom-0">
    @for (
      eachFormConfig of formConfig; track
      eachFormConfig; let outerIndex = $index; let last = $last) {
      <div
        #formGroupAnchor
      [ngClass]="{
        'ogp-display-none': outerIndex !== navIndex,
        'ogp-display-bloc': outerIndex === navIndex
      }"
        >
        <form
          [formGroup]="formList[outerIndex]"
          (ngSubmit)="onFormSubmit(outerIndex)"
          [hidden]="outerIndex !== navIndex"
          >
          <!-- For each form, it will list all the control or form element-->
          <div
            [hidden]="outerIndex !== navIndex"
            class="grid-row"
          [ngClass]="{
            'flex-row': eachFormConfig.formButtons.add,
            'flex-align-end': eachFormConfig.formButtons.add,
            'flex-column': !eachFormConfig.formButtons.add
          }"
            >
            @for (
              eachControl of allControlList[outerIndex]; track
              eachControl; let index = $index; let first = $first) {
              <div
                class="form-section"
            id="form-section-{{
              eachFormConfig.formElements[0].formSectionId
                ? eachFormConfig.formElements[0].formSectionId
                : controlList.length * outerIndex + index
            }}"
                #formSection
                >
                @if (
                  !eachFormConfig.formElements[index].hidden &&
                  eachFormConfig.formElements[index].formSection
                  ) {
                  <h1
                    class="margin-bottom-2"
                    [ngClass]="{ 'margin-top-3': 'index!==first' }"
                    id="{{ eachFormConfig.formElements[index].controlName }}"
                    >
                    <b>{{ eachFormConfig.formElements[index].formSection }}</b>
                  </h1>
                }
                @if (
                  !eachFormConfig.formElements[index].hidden &&
                  eachFormConfig.formElements[index].formsectionText
                  ) {
                  <h3
                    id="{{ eachFormConfig.formElements[index].controlName }}"
                    >
                    {{
                    eachFormConfig.formElements[index].formsectionText &&
                    eachFormConfig.formElements[index].formsectionText
                    }}
                  </h3>
                }
                @if (!eachFormConfig.formElements[index].hidden) {
                  <div
                    class="margin-top-2"
                    >
                    @if (
                      eachFormConfig.formElements[index].elementType === 'text'
                      ) {
                      <art-text-field
                        [formData]="eachFormConfig.formElements[index]"
                        [hidden]="false"
                (eltClicked)="
                  onElementClick(
                    $event,
                    outerIndex,
                    eachFormConfig.formElements[index].controlName
                  )
                "
                        [control]="eachControl"
                        >
                      </art-text-field>
                    }
                    <!-- Radio Button Group -->
                    @if (
                      eachFormConfig.formElements[index].elementType ===
                      'radioButtonGroup' &&
                      !eachFormConfig.formElements[index].hidden
                      ) {
                      <div
                        >
                        <art-radiobutton-group
                          [formData]="eachFormConfig.formElements[index]"
                          [hidden]="false"
                  (eltClicked)="
                    onElementClick(
                      $event,
                      outerIndex,
                      eachFormConfig.formElements[index].controlName
                    )
                  "
                          [formGroup]="eachControl"
                        ></art-radiobutton-group>
                      </div>
                    }
                    @if (
                      eachFormConfig.formElements[index].elementType ===
                      'checkboxGroup' &&
                      !eachFormConfig.formElements[index].hidden
                      ) {
                      <art-checkbox-group
                        [formData]="eachFormConfig.formElements[index]"
                        [formGroup]="eachControl"
                        [dataUpdated]="eltUpdated"
                (eltClicked)="
                  onElementClick(
                    $event,
                    outerIndex,
                    eachFormConfig.formElements[index].controlName
                  )
                "
                        >
                      </art-checkbox-group>
                    }
                  </div>
                }
              </div>
            }
            @if (loading) {
              <div
                tabindex="0"
                aria-label="Content is loading, additional information is being displayed"
                class="ogp-flex-center"
                >
                <div class="lds-ripple">
                  <div></div>
                  <div></div>
                </div>
              </div>
            }
            <!-- This button will be disable if the form is not valid and if the value is null-->
            @if (eachFormConfig.formButtons.add) {
              <button
            [disabled]="
              !formList[outerIndex].valid || formList[outerIndex].value === null
            "
                id="art-add-btn for index {{ outerIndex }}"
                aria-label="Add an ICT Item"
                class="usa-button usa-button--accent-warm art-add-btn"
                type="submit"
                >
                {{ eachFormConfig.formButtons.add }}
              </button>
            }
          </div>
        </form>
        <br />
        <!-- Will display the information box to tell the user the form is completed when all field on that form are checked-->
        @if (formCompletetion[this.navIndex] === true) {
          <div
            class="usa-alert usa-alert--info usa-alert--no-icon margin-bottom-3 margin-top-neg-1"
            >
            <div class="usa-alert__body">
              <p class="usa-alert__text">You have completed the form.</p>
            </div>
          </div>
        }
      </div>
    }
    @if (this.router.url.includes('form-page') && showButtonControls) {
      <div
        class="ogp-flex"
        >
        <div>
          <art-button
            class="ogp-btn"
            [disabled]="navIndex === 0"
            [buttonData]="backButton"
            (click)="navBackForm()"
            >
          </art-button>
          @if (navIndex <= formConfig.length - 2) {
            <art-button
              class="ogp-btn"
              [buttonData]="nextButton"
              (click)="navNextForm()"
              >
            </art-button>
          }
          @if (navIndex === formConfig.length - 1) {
            <button
              [disabled]="formCompletetion[this.navIndex] === false"
              class="ogp-btn usa-button usa-button--accent-warm"
              type="submit"
              (click)="onFormSubmit(0)"
              >
              {{ formConfig[0].formButtons.submit }}
            </button>
          }
          @if (navIndex > 0) {
            <button
              class="ogp-btn usa-button usa-button--secondary ogp-btn-delete"
              type="button"
              (click)="deleteICT()"
              aria-label="Delete Current ICT"
              >
              Delete Current ICT
            </button>
          }
        </div>
        @if (formConfig[0].formButtons.submit) {
          <div class="ogp-btn">
            <art-save-json
              [saveAsInfo]="{ btnName: 'Save (.json)', fileName: 'jsonData.json' }"
              [ictItem]="currentFormData"
            ></art-save-json>
            <!-- <button
            (click)="onReset()"
            class="usa-button usa-button--secondary"
            type="button">Clear Form
          </button> -->
        </div>
      }
    </div>
  }
  @if (errorSummary.length > 0) {
    <div class="error-summary margin-top-2">
      <!-- <h2>Form Errors</h2> -->
      <p>
        <b>Form Errors-</b> you must complete all the questions in order to get
        the 508 results. Select the links below to go to the unanswered
        question(s)
      </p>
      <ul>
        @for (error of errorSummary; track error) {
          <li
            (click)="scrollToSection(error.controlName)"
            >
            @if (error.message) {
              <div>
                @if (error.message.maxlength) {
                  <b>{{ getSectionLabel(error.section) }}: </b>
                  {{ " " + error.message.maxlength }}
                }
                @if (!error.message.maxlength && error.message.required) {
                  <b>{{ getSectionLabel(error.section) }}: </b>
                  {{ " " + error.message.required }}
                }
              </div>
            }
          </li>
        }
      </ul>
    </div>
  }
</div>
</div>
